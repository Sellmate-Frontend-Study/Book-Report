# CHAPTER 01 리팩터링: 첫 번째 예시

## 📚 읽은 내용

### 리팩토링 처리의 원칙 => <strong style="background: #F9F9C8; color: black">코드 작성 후 설계 및 개선</strong>

완벽한 설계 후 코드를 작성할 수 있으면 좋지만, 현실적으로 요구사항은 계속 추가되어 들어오고, 해당 요구사항에 맞게 코드를 적용하며 리팩토링을 진행해야함.

### 리팩터링 방식
- **테스트를 위한 함수처리**
  - 테스트 처리를 위해서는 기본적인 함수처리가 필요.

- **테스트 자동화**
  - 매번 하나하나 데이터를 넣어보며 체크할 수 없는 노릇이니 테스트 자동화 툴을 이용해 테스트 진행.

- **함수 추출하기**
  - 수정할 부분을 묶어서 함수로 처리. 테스트 목적 
  - IDE에서 자동 실행해주는 기능 활용
  - 추출된 함수의 함수명이나 변수명은 반드시 적절하게 수정

- **임시 변수(Temporary Variable)를 질의 함수(Query Function)로 바꾸기**
  - 여기서 말하는 임시 변수는 사실상 함수 내의 지역 변수(Local Variable)를 의미
  - 질의 함수란 계산 함수, 함수형 프로그래밍에서 말하는 순수 함수와 비슷한 개념.
  
- **변수 인라인하기**
  - 질의 함수로 변경하면서 생겨난 각 렉시컬 스코프의 로컬 변수를 인라인화하여 처리

- **함수 선언 바꾸기**  
  - 함수명을 더 명시적이고 이해하기 쉽게 변환
  - 함수를 쪼갤수록 함수명은 더 구체적이어야하며 명확해야함.

- **문장 슬라이스하기**
  - 특정 로직에서 사용하는 외부 지역변수를 해당 로직과 가까이 처리
  - 로직과 변수간의 관계를 더 명확히 드러내기 위함

- **반복문 쪼개기**
  - 하나의 반복문 내에서 여러 작업이 수행될 때, 이를 각각 별도의 반복문으로 분리
  - 성능상 문제가 있을 수 있으나, 우선 코드를 정리하여 해당 반복문의 역할을 명확히 한 후 다시 리팩터링을 진행하여 결합시키는 방식으로 진행을 권장

### 질의 함수와 순수 함수의 차이점?
  - **순수함수**
    - 함수형 프로그래밍에서 순수 함수는 다음 두 가지 주요 특징을 갖는다.
      - 결과의 일관성: 같은 입력에 대해 항상 같은 결과를 반환한다.
      - 부작용의 부재: 함수가 외부 상태를 변경하지 않으며, 외부 상태에 의존하지 않는다.
    - 순수 함수는 전역 변수를 사용하지 않고, 함수의 결과가 오직 입력 값에만 의존한다.
  - **질의 함수(Query Function)**
    - 질의 함수는 객체의 상태를 조회하는 데 사용되며, 다음 특징을 갖는다.
      - 객체 상태의 조회: 객체의 상태나 속성 값을 반환한다.
      - 부작용의 부재: 객체의 상태를 변경하지 않는다.
    - 질의 함수는 주로 객체의 상태를 읽는 데 사용되지만, 반드시 순수 함수일 필요는 없다.
    - 예를 들어, 객체 내부의 필드 값을 기반으로 계산된 결과를 반환할 수 있다. 이 경우, 함수의 결과는 내부 상태에 의존하기 때문에 엄밀한 의미에서 순수 함수라고 할 수 없다.

정리하자면, 순수함수는 어떤 외부의 상태에도 의존하지 않고 변경하지 않는 함수를 의미한다.
하지만 질의 함수는 객체의 상태를 조회하는 함수로, 부작용을 일으키지 않는 한도 내에서 객체의 상태에 의존하는 것이 가능하다.

따라서 질의 함수는 순수 함수의 부분집합이라고 할 수 있다.

### 테스트에 있어서 중첩함수의 역할
- 중첩 함수는 직접적으로 테스트하기 어려움. 이는 중첩 함수가 외부에서 직접 접근할 수 없는 상위 함수의 스코프 내에 존재하기 때문.
- 그렇기에 테스트를 수행할 때는 중첩 함수를 포함하고 있는 클로저를 대상으로 해야함. 중요한 점은 중첩 함수가 클로저의 컨텍스트, 즉 상위 함수의 변수와 환경에 의존한다는 것. 이 의존성 때문에, 중첩 함수의 행동은 해당 중첩함수를 둘러싼 클로저의 상태에 따라 달라질 수 있음.
- 따라서, 테스트 과정에서는 이러한 클로저와 중첩함수의 의존적 관계를 이해하여, 클로저 하나만을 테스트하는 것으로서 내부의 중첩함수를 모두 일괄적으로 테스트가 가능하다는 사실을 인지해야함

### 추가
> 매개변수의 역할이 뚜렷하지 않을 때는 부정관사(a/an)를 붙인다.



## 📚 느낀점

테스트가 가장 중요하다. 일련의 리팩토링 방식들은 어떻게 테스트를 더 정확하고 자세하게 실행할지에 대한 지침이라고 생각됨.


## 📚 공유하고 싶은 부분(사이트)


